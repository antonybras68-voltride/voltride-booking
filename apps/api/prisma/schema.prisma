generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Agency {
  id         String      @id @default(cuid())
  code       String      @unique
  name       Json
  address    String
  city       String
  postalCode String
  country    String      @default("ES")
  phone      String
  email      String
  brand      String      @default("VOLTRIDE")
  openingTime String      @default("10:00")
  closingTimeSummer String @default("19:00")
  closingTimeWinter String @default("16:00")
  summerStartDate String      @default("04-01")
  summerEndDate   String      @default("09-30")
  isActive   Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  bookings   Booking[]
  inventory  Inventory[]
}

model Category {
  id         String    @id @default(cuid())
  code       String    @unique
  name       Json
  brand      String    @default("VOLTRIDE")
  openingTime String      @default("10:00")
  closingTimeSummer String @default("19:00")
  closingTimeWinter String @default("16:00")
  summerStartDate String      @default("04-01")
  summerEndDate   String      @default("09-30")
  bookingFee Float     @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  vehicles   Vehicle[]
  options    OptionCategory[]
}

model Vehicle {
  id          String        @id @default(cuid())
  sku         String        @unique
  name        Json
  description Json
  deposit     Float
  hasPlate    Boolean       @default(false)
  licenseType     String?       @default("")
  kmIncluded      String?       @default("")
  helmetIncluded  Boolean       @default(true)
  imageUrl    String?
  categoryId  String
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  category    Category      @relation(fields: [categoryId], references: [id])
  pricing     Pricing[]
  inventory   Inventory[]
  bookingItems BookingItem[]
}

model Pricing {
  id         String   @id @default(cuid())
  vehicleId  String
  day1       Float    @default(0)
  day2       Float    @default(0)
  day3       Float    @default(0)
  day4       Float    @default(0)
  day5       Float    @default(0)
  day6       Float    @default(0)
  day7       Float    @default(0)
  day8       Float    @default(0)
  day9       Float    @default(0)
  day10      Float    @default(0)
  day11      Float    @default(0)
  day12      Float    @default(0)
  day13      Float    @default(0)
  day14      Float    @default(0)
  extraHour1 Float    @default(0)
  extraHour2 Float    @default(0)
  extraHour3 Float    @default(0)
  extraHour4 Float    @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
}

model Inventory {
  id        String   @id @default(cuid())
  vehicleId String
  agencyId  String
  quantity  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  agency    Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@unique([vehicleId, agencyId])
}

model Option {
  id            String          @id @default(cuid())
  code          String          @unique
  name          Json
  maxQuantity   Int             @default(10)
  includedByDefault Boolean     @default(false)
  day1          Float           @default(0)
  day2          Float           @default(0)
  day3          Float           @default(0)
  day4          Float           @default(0)
  day5          Float           @default(0)
  day6          Float           @default(0)
  day7          Float           @default(0)
  day8          Float           @default(0)
  day9          Float           @default(0)
  day10         Float           @default(0)
  day11         Float           @default(0)
  day12         Float           @default(0)
  day13         Float           @default(0)
  day14         Float           @default(0)
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  categories    OptionCategory[]
  bookingOptions BookingOption[]
}

model OptionCategory {
  id         String   @id @default(cuid())
  optionId   String
  categoryId String
  option     Option   @relation(fields: [optionId], references: [id], onDelete: Cascade)
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([optionId, categoryId])
}

model Customer {
  id        String    @id @default(cuid())
  firstName String
  lastName  String
  email     String
  phone     String
  address   String?
  postalCode String?
  city      String?
  country   String    @default("ES")
  language  String    @default("es")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]
}

model Booking {
  id            String          @id @default(cuid())
  reference     String          @unique
  agencyId      String
  customerId    String
  startDate     DateTime
  endDate       DateTime
  startTime     String
  endTime       String
  totalPrice    Float
  depositAmount Float
  status        String          @default("PENDING")
  language      String          @default("es")
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  agency        Agency          @relation(fields: [agencyId], references: [id])
  customer      Customer        @relation(fields: [customerId], references: [id])
  items         BookingItem[]
  options       BookingOption[]
}

model BookingItem {
  id         String   @id @default(cuid())
  bookingId  String
  vehicleId  String
  quantity   Int
  unitPrice  Float
  totalPrice Float
  createdAt  DateTime @default(now())
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
}

model BookingOption {
  id         String   @id @default(cuid())
  bookingId  String
  optionId   String
  quantity   Int
  unitPrice  Float
  totalPrice Float
  createdAt  DateTime @default(now())
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  option     Option   @relation(fields: [optionId], references: [id])
}
